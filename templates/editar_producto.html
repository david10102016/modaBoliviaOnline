<!DOCTYPE html>
<html lang="es">
<head>
    <title>Editar Producto - Moda Bolivia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .form-card { box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-radius: 10px; }
        .form-card-header { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .img-preview { max-width: 100%; height: auto; max-height: 200px; border-radius: 5px; }
        .form-label { font-weight: bold; }
        .btn-save { background: linear-gradient(135deg, #28a745, #20c997); border: none; }
        .btn-save:hover { background: linear-gradient(135deg, #20c997, #28a745); }
    </style>
</head>
<body>
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                <div class="card form-card">
                    <div class="card-header form-card-header text-center">
                        <h4 class="mb-0"><i class="fas fa-edit me-2"></i>Editar Producto</h4>
                    </div>
                    <div class="card-body">
                        <form method="POST" enctype="multipart/form-data" id="editProductForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="nombre" class="form-label">Nombre *</label>
                                    <input type="text" class="form-control" id="nombre" name="nombre" value="{{ producto['nombre'] }}" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="precio" class="form-label">Precio *</label>
                                    <input type="number" class="form-control" id="precio" name="precio" step="0.01" value="{{ producto['precio'] }}" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="stock" class="form-label">Stock *</label>
                                    <input type="number" class="form-control" id="stock" name="stock" value="{{ producto['stock'] }}" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="categoria_id" class="form-label">Categoría *</label>
                                    <select class="form-select" id="categoria_id" name="categoria_id" required>
                                        {% for cat in categorias %}
                                            <option value="{{ cat['id'] }}" {% if cat['id'] == producto['categoria_id'] %}selected{% endif %}>
                                                {{ cat['nombre'] }} ({{ cat['tipo'] }})
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label for="descripcion" class="form-label">Descripción</label>
                                    <textarea class="form-control" id="descripcion" name="descripcion" rows="4">{{ producto['descripcion'] }}</textarea>
                                </div>
                                <div class="col-12">
                                    <label for="imagen" class="form-label">Imagen (opcional)</label>
                                    <input type="file" class="form-control" id="imagen" name="imagen" accept="image/*">
                                    {% if producto['imagen'] %}
                                        <div class="mt-2">
                                            <label class="form-label small">Imagen actual:</label>
                                            <img src="{{ producto['imagen'] }}" alt="Imagen actual" class="img-preview">
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-12 text-end">
                                    <a href="{{ url_for('ver_productos') }}" class="btn btn-secondary me-2">
                                        <i class="fas fa-arrow-left me-1"></i>Volver
                                    </a>
                                    <button type="submit" class="btn btn-save">
                                        <i class="fas fa-save me-1"></i>Guardar Cambios
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        Swal.fire({
                            icon: '{{ category }}',
                            title: '{{ category | capitalize }}',
                            text: '{{ message | safe }}',
                            confirmButtonColor: '#3085d6',
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        });
                    {% endfor %}
                {% endif %}
            {% endwith %}

            document.getElementById('editProductForm').addEventListener('submit', function(e) {
                Swal.fire({
                    title: 'Guardando...',
                    text: 'Por favor, espera un momento.',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
            });
        });
    </script>
</body>
</html>